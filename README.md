# alert-templates-helm-vmalert-impulse
Шаблонизация правил алертов в Helm и их обработка через vmalert и Impulse для отправки в Telegram.

## 1. Создание приложения на Go с метриками Golden Signal
Цель — собрать базовую сервисную логику, которая одновременно генерирует и экспортирует метрики, отражающие четыре золотых сигнала (Golden Signal): задержку, пропускную способность, ошибки и насыщение. Приложение на Go обычно включает HTTP-эндпоинт, собирающий метрики Prometheus, а также внутренние счетчики:

- **Latency**: измеряется гистограммами или суммами времени запроса, например, через `Prometheus`-гистограмму.
- **Traffic**: отображается метриками счетчиков запросов и размера payload.
- **Errors**: отдельные счетчики для неудачных ответов и исключительных ситуаций.
- **Saturation**: измеряется через загрузку горутин или потребление памяти.

Взаимодействие с Prometheus реализуется через клиентскую библиотеку Go и middleware, оборачивающее HTTP-хендлеры, чтобы автоматически регистрировать время выполнения и код ответа.

## 2. Шаблонизация алертов в Helm-чарте
Шаблоны Helm позволяют динамически генерировать правила алертов на основе переменных и модельных условий. Вручную создаются шаблоны для `PrometheusRule`, где параметры, такие как `severity`, `description` и выражения, берутся из values-файлов. При этом можно использовать функции Sprig и вспомогательные шаблоны для единообразного формирования имен метрик и лейблов, чтобы с одной стороны упрощать поддержку, а с другой — держать конфигурацию прозрачной для команд разработки и SRE.

## 3. Отправка алертов в vmalert и Alertmanager
Сгенерированные правила Helm монтируются в vmalert, который периодически оценивает выражения и, при срабатывании, пересылает события в Alertmanager. Такая цепочка дает гибкость: Helm хранит версионность правил, vmalert делает evaluation, а Alertmanager занимается маршрутизацией и обработкой группировок. Разделение ролей позволяет легко масштабировать каждый компонент и поддерживать observability.

## 4. Передача алертов через Impulse в Telegram
Impulse выступает адаптером между Alertmanager и внешними каналами уведомлений. Настраивается прием webhook'ов от Alertmanager, затем Impulse преобразует события, добавляя контекст (ссылки, срезы метрик) и пересылает их в Telegram через бота. Используя шаблонные данные из Impulse, можно аккумулировать карточки с требуемыми полями — уровень серьезности, значение метрики, команда ответственных. Такая архитектура обеспечивает доставку Golden Signal алертов грувом в Telegram-чат, сохраняя трассировку через Helm → vmalert → Alertmanager → Impulse.

## 5. Сборка и проверка Docker-образа Go-приложения
1. Соберите образ в каталоге [`app`](app:1) с помощью [`app/Dockerfile`](app/Dockerfile:1-8): `docker build -t golden-signal -f app/Dockerfile app`.
2. Запустите контейнер: `docker run -d --rm -p 8080:8080 --name golden-signal golden-signal`.
3. Проверьте доступность метрик: `curl http://localhost:8080/metrics`.
4. Зафиксируйте Golden Signal-метрики вызовом рабочего эндпоинта `curl http://localhost:8080/work`, а затем снова опросите `/metrics`.
5. После проверки остановите контейнер: `docker stop golden-signal`.

## Заключение
Комбинация приложения на Go, Helm-шаблонов, vmalert/Alertmanager и Impulse обеспечивает полную цепочку от генерации Golden Signal метрик до доставки уведомлений в Telegram и делает инфраструктуру alerting-цепочки прозрачной и легко масштабируемой.
